<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>SIPAKU - Home</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
    <script src="scripts/Chart.min.js"></script>
    <script src="scripts/utils.js"></script>
</head>
<body id="body" style="visibility:hidden">
    <!-- nav bar-->
    <nav class="navbar navbar-expand-lg navbar-static-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
              <img src="img/logo.png" title="logo" id="logo"/>
                <b id="brand-title">SIPAKU</b>
            </a>
        </div>
        <div class="collapse navbar-collapse" id="Navbar">
                <ul class="navbar-nav ml-auto nav">
                    <li class="nav-list"><button class="btn btn-dark btn-nav" onclick="logOut();">Keluar</button></li>
                </ul>
            </div>
    </nav>

    <!-- Uploader -->
    <div class="jumbotron">
        <div class="container">
            <div class="row justify-content-md-center">
                <div class="col col-lg-2"></div>
                <div class="col-md-auto">
                    <div class="row">
                        <h1 class="upload-title">Welcome to SIPAKU</h1>
                    </div>
                </div>
                <div class="col col-lg-2"></div>
            </div>          
        </div>

        <div style="width:100%;">
            <canvas id="canvas"></canvas>
            <div id="chartContainer" ></div>
        </div>
        <br>
        <br>
    </div>
    
    <div id="modal-message"></div>


    <!-- Importing scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@3.2.0/dist/amazon-cognito-identity.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aws-sdk/2.543.0/aws-sdk.min.js"></script>
    <script src="scripts/script.js"></script>
    
    <script>
        $(document).ready(function(){
            $.ajax({
                url: "https://5zij6j6dg8.execute-api.us-east-1.amazonaws.com/SipakuBaca",
                method: "GET",
                success: function(data) {
                console.log(data);
                var Time = [];
                var Value = [];
                var Timestamp =[];
    
                for(var i in data) {
                    Time.push(data[i].Time);
                    Value.push(data[i].Value);
                    Timestamp.push(data[i].Timestamp);
                }
    
                var chartdata = {
                    labels: Time,
                    
                    datasets : [
                    {   
                        label: 'Air Quality Control',
                        backgroundColor: 'rgba(0, 119, 204, 0.3)',
                        borderColor: 'rgba(200, 200, 200, 0.75)',
                        hoverBackgroundColor: 'rgba(200, 200, 200, 1)',
                        hoverBorderColor: 'rgba(200, 200, 200, 1)',
                        data: Value
                    }]
                };
    
                var ctx = $("#canvas");
    
                var barGraph = new Chart(ctx, {
                    type: 'line',
                    data: chartdata,
                    options: {
                        responsive: true,
                        title: {
                            display: true,
                            text: 'Air Quality Monitoring System Per '+Timestamp[0],
                        },
                        tooltips: {
                            mode: 'index',
                            intersect: false,
                        },
                        hover: {
                            mode: 'nearest',
                            intersect: true
                        },
                        scales: {
                            xAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Time'
                                }
                            }],
                            yAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Air Quality Value'
                                }
                            }]
                        }
                    }
                });
                },
                error: function(data) {
                console.log(data);
                }
            });
        });
    </script>

    <script type="text/javascript">
        $(function(){
            checkLogin(false, true);
        })           
    </script>
</body>
</html>